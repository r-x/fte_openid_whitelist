<!DOCTYPE HTML PUBLIC "-/equest/W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
 
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Set up PayPal Identity</title>
    
	<style TYPE="text/css">body {
			font-family: Helvetica, sans-serif;
			font-size: 14pt;
		}
		hr {
			background: url(hr.png);
			border-width: 0px;
			height: 3px;
		}
		input[type=text] {
			padding: 0em 10px;
		}
		.arrow {
			float: left;
			visibility: hidden;
		}
		.continue {
			background-color: #E6E6E6;
			border-color: #D3D3D3;
			border-style: solid;
			border-width: 2px;
			color: #A3A3A3;
			float: left;
			font-size: 12pt;
			-moz-border-radius: 6px;
		}
		div#explanationBackground {
			background: -moz-linear-gradient(top, #557aa0, #294E73);
			background-color: #294E73;
			box-shadow: 4px 4px 2px #AAA;
			color: #FFFFFF;
			font-size: 10pt;
			font-weight: normal;
			left: -10px;
			line-height: 120%;
			-moz-border-radius: 10px;
			padding: 10px;
			position: relative;
			visibility: hidden;
		}
		.innerPanel {
			background-color: #EAF1F6;
			border-style: solid;
			-moz-border-radius: 10px;
			border-spacing: 0.5em;
			border-width: 0px;
			padding-left: 1em;
			padding-right: 1em;
			width: 100%;
		}
		.inputFields {
			background-color: #EEF7D1;
			border-radius: 6px;
			color: #999999;
			font-size: 12pt;
			height: 2em;
			letter-spacing: -0.5px;
		}
		a:visited#navLink {
			color: blue;;
		}
		.outerBorder {
			border-spacing: 8px;
			border-width: 0px;
			height: 500px;
			width: 500px;
		}
		td#secondHeader {
			color: #4B5965;
		}
		div#title {
			color: #003366;
			font-size: 24pt;
			padding: 0.5em 0em 1em 0.5em;
		}
		span#userAgreement {
			font-size: 8pt;
			color: #848587;
			padding-top: 1em;
		}
</style>
</head>
 
<body>

	<div id="title"></div>
	
	<table class="outerBorder">
		<tr>
			<td colspan="2" style="vertical-align: top;height: 1em;">

				<table class="innerPanel">
					<tr>
						<td id="secondHeader" style="padding-top:1em;">
						</td>
					</tr>
					<tr>
						<td id="topHr"><hr/></td>
					</tr>
					<tr id="entryFields">
						<td>
							<table>
								<tr>
									<td style="vertical-align: top;">
										<table>								
											<tr>
												<td style="padding-bottom: 0.5em;">
													<input id="websiteNameInput" class="inputFields" name="website_name" type="text" size="22" value="Website display name">
												</td>
												<td style="vertical-align:middle; color:#4E7399;">
													<span id="nameArrow" class="arrow">
														&#x25C0;
													</span>
												</td>								
											</tr>
											<tr>
												<td style="padding-top: 0.5em;">
													<input id="websiteInput" class="inputFields" name="website_url" type="text" size="22" value="Website">
												</td>
												<td style="vertical-align:middle;">
													<span id="urlArrow" class="arrow" style="visibility:hidden; color:#33587D;">
														&#x25C0;
													</span>
												</td>																				
											</tr>
										</table>										
									</td>
									
									<td style="vertical-align: top; height:150px;">
										<div id="explanationSpacer"></div>
										<div id="explanationBackground" class="explanation">
											<div id="explanationText">
											</div>
										</div>
									</td>
								</tr>
							</table>
					
						</td>
					</tr>
					<tr>
						<td>
							<span id="userAgreement" class="request">By clicking Continue below, you agree to our <a href="#">User Agreement</a></span>
						</td>
					</tr>
					<tr id="dataVerification" style="display:none;">
						<td>
							<table>
								<tr>
									<td colspan="2" style="padding-bottom: 1em;">
										You have successfully registered the following website:
									</td>
								</tr>
								<tr>
									<td style="width:35%;">
										<b>Display name</b>
									</td>
									<td id="displayNameVerification">											
									</td>
								</tr>
								<tr>
									<td>
										<b>Website</b>
									</td>
									<td id="websiteVerification">											
									</td>
								</tr>
							</table>
						</td>							
					</tr>
					<tr>
						<td style="font-size:0px;">
							<hr/>
						</td>
					</tr>
					<tr>
						<td>
							<table width="100%;">
								<tr>
									<td id"="buttonBackground" onclick="javascript:requestWhitelisting();" style="cursor:pointer;">
										<table id="theButton" class="continue">
											<tr>
												<td style="padding: 0.5em 2em 0.5em 2em;">
													<a id="buttonLink" style="text-decoration: none; color:#A3A3A3;" href="javascript:requestWhitelisting();">Continue</a>
												</td>
											</tr>	
										</table>
										<div style="padding-top:12px;" class="request">
											<a href="#" id="navLink" style="padding-left:1em;font-size:12pt;">Cancel</a>
										</div>
									</td>
									<td style="text-align: right"><a href="http://paypal.com"><img src="paypal_logo.png" alt="PayPal logo"/></a></td>										
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</td>
		</tr>		
	</table>
	
	
	<!-- jQuery --> 
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
 
 	<script type="text/javascript">

 		$(document).ready(function () {

 			var websiteNameInput 		= $("#websiteNameInput"),
	 			websiteInput 			= $("#websiteInput");
 				validColor 				= "#EEF7D1",
	 			invalidColor 			= "#FF8787",
	 			nameArrow 				= $("#nameArrow"),
	 			urlArrow 				= $("#urlArrow"),
	 			explanationText 		= $("#explanationText"),
	 			explanationBackground 	= $("#explanationBackground"),
	 			explanationSpacer 		= $("#explanationSpacer"),
	 			websiteText 			= "Website",
	 			theButton 				= $("#theButton"),
	 			buttonLink 				= $("#buttonLink" ),
	 			websiteDisplayNameText 	= "Website display name";


 			// ----- Display name -----	

 			websiteNameInput.val(websiteDisplayNameText);

 			websiteNameInput.focusin(function () {
 				explanationSpacer.css("padding-top", "0em");
 				explanationText.html("This display name will appear whenever we refer to you.  Please choose something appropriate and ideally less than 28 characters.");
 				explanationBackground.css("visibility", "visible");
 				nameArrow.css("visibility", "visible");
 			});

 			websiteNameInput.focusout(function () {
 				explanationBackground.css("visibility", "hidden");
 				nameArrow.css("visibility", "hidden");
 			});

 			websiteNameInput.keydown(function (event) {	
  				if( event.keyCode == 16 )  // RKC: An odd one.  Firefox Windows sends this "ctrl" button in for no reason I can discern.
 					return;

 				if( event.keyCode == 9 || event.keyCode == 13 ) {
					 websiteInput.focus();
					 event.preventDefault();
					 return;
 				}

 				if( websiteNameInput.val() == websiteDisplayNameText )
 					websiteNameInput.val( "" );

 				websiteNameInput.css("color", "black");
 			});
 			
 			websiteNameInput.keyup(function() {
				setStateForButton( buttonShouldBeActive() );
 			});

 			websiteNameInput.blur(function () {
 				if( websiteNameInput.val().length == 0 ) {
 					websiteNameInput.val( websiteDisplayNameText );
 					websiteNameInput.css( "color", "#999999" );
 				}
 			});

 			websiteNameInput.focus();


 			// ----- URL -----
 			
 			websiteInput.focusin(function () {
 				explanationSpacer.css("padding-top", "1em");
 				explanationBackground.css("visibility", "visible");
 				urlArrow.css("visibility", "visible");
 				explanationText.html( "Enter your website URL (e.g. <i>domain.com<i>)" );
 			});

 			websiteInput.focus(function () {
 				this.selectionEnd = -1;
 			});

 			websiteInput.focusout(function () {
 				explanationBackground.css("visibility", "hidden");
 				urlArrow.css("visibility", "hidden");
 			});

 			websiteInput.keydown(function (event) {
 				if( event.keyCode == 9 ) {
 					event.preventDefault();
 					buttonLink.focus(); 					
 					return;
 				}
 				
 				if( event.keyCode == 13 ) {
 					if( buttonShouldBeActive() ) {
 						requestWhitelisting();
 						event.preventDefault();
 						return;
 					}
 					else if( linkIsValid(websiteInput.val()) ) {
 						websiteNameInput.focus();
 						event.preventDefault();
 						return;
 					}
 				}  				
 				if (websiteInput.val() == websiteText)
 					websiteInput.val("");
 				websiteInput.css("color", "black");
  			});

 			websiteInput.keyup(function() {
 				var link = websiteInput.val();
 				if( link == websiteText || linkIsValid(link) )
 					websiteInput.css("background-color", validColor);
 				else
 					websiteInput.css("background-color", invalidColor);
 					 				
				setStateForButton( buttonShouldBeActive() );
 			});

 			websiteInput.blur(function () {
 				if (websiteInput.val().length == 0) {
 					websiteInput.val(websiteText);
 					websiteInput.css("color", "#999999");
 					websiteInput.css("background-color", validColor);
 				}
 			});
 			
 			function linkIsValid( s ) {
 				return /.+\..+/.test( s );				
 			}
 			
 			function buttonShouldBeActive() {
 				if( mode == "complete" )
 					return true;

				var name = websiteNameInput.val();
				var validName = name.length > 0 && name != websiteDisplayNameText;
				var validUrl = linkIsValid( websiteInput.val() );
			
				return validName && validUrl;
 			}
 		});
 		
 		var buttonActive 			= false,
 			mode 					= "request",
 			requestTitle 			= "Set up PayPal Access",
 			completeTitle			= "Set up is now complete",
 			requestSecondHeader 	= "Share a few details",
 			completeSecondHeader 	= "Thanks for using PayPal Access!";
 			
 		$( "#title" ).html( requestTitle );
 		$( "#secondHeader" ).html( requestSecondHeader );


		function setStateForButton( state ) {
			buttonActive = state;
			
			if( buttonActive ) {
				theButton.css( "border-color", "#F39033" );
				theButton.css( "background-color", "#FCB92A" );
				theButton.css( "background", "-moz-linear-gradient(top, #FEEBCE, #FBB11B)" );
				
				buttonLink.css( "color", "black" );	
			}
			else {
				theButton.css( "border-color", "#D3D3D3" );
				theButton.css( "background-color", "#E6E6E6" );
				theButton.css( "background", "" );
				
				buttonLink.css( "color", "#A3A3A3" );
			}
		}
		
		function handleWhitelistResponse( jqXHR, textStatus ) {
			var result	= jqXHR.responseText.split(":")[0];
			var message	= jqXHR.responseText.split(":")[1];
			
			if( result == "SUCCESS" )
				toggleScreen();
			else
				alert( message );
		}
	
		function requestWhitelisting() {
			whitelistUrl = "http://corell.arathika.com/fte_openid_whitelist/proxy.cgi?name=" + $("#websiteNameInput").val() + "&url=" + $("#websiteInput").val();
			
			jQuery.ajax({ url: whitelistUrl, complete : handleWhitelistResponse });
		}
		
 		function toggleScreen() {
 			if( !buttonActive )
 				return;
			
			var navLink = $( "#navLink" ),
 				buttonLink = $("#buttonLink");		
 			
 			if( mode == "request" ) {
	 			$("#title").html( completeTitle );
 				$("#secondHeader").html( completeSecondHeader );
	 			navLink.html( "Back" );
	 			navLink.attr( "href", "javascript:toggleState();")
	 			$("#userAgreement").hide();
	 			$("#entryFields").hide();
 				$("#dataVerification" ).css( "display", "block" );
 				$("#displayNameVerification").html( $("#websiteNameInput").val() );
 				$("#websiteVerification").html( $("#websiteInput").val() );
 				buttonLink.html( "Close" );
 				buttonLink.attr( "href", "#" );
 				$("#buttonBackground").attr( "href", "#" );
 				setStateForButton( true );
 				
 				mode = "complete";	
 			}
 			else {
	 			$("#title").html( completeTitle );
 				$("#secondHeader").html( requestSecondHeader )
	 			navLink.html( "Cancel" );
	 			navLink.attr( "href", "#")
	 			$("#userAgreement").show();
	 			$("#entryFields").show();
 				$("#dataVerification" ).css( "display", "none" );
 				buttonLink.html( "Continue" );
 				buttonLink.attr( "href", "javascript:requestWhitelisting();" );
 				$("#buttonBackground").attr( "href", "javascript:requestWhitelisting();" );
 				setStateForButton( true );
 				
 				mode = "request";
 			}
 		} 			

 
 	</script>

</body>
</html>